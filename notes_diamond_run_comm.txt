Env
export VOL=/workspace 
export PATH="$VOL/micromamba:$PATH"
eval "$(micromamba shell hook -s bash)"

micromamba activate /workspace/mamba/envs/dagger


python scripts/analyze_diamond_actions.py --data-root data/task_diamond_decoded --use-decoded --n-camera-bins 5
python scripts/analyze_diamond_actions.py --data-root data/task_diamond --raw-camera-only


Decoding
python scripts/decode_diamond_frames.py \
    --data-root data/task_diamond \
    --output-root data/task_diamond_decoded_nbin \
    --num-workers 8


Training
python scripts/train_diamond_bc.py \
    --data-root data/task_diamond_decoded_nbin \
    --use-decoded \
    --epochs 150 \
    --batch-size 512 \
    --context-frames 1 \
    --train-fraction 1.0 \
    --val-fraction 0.03 \
    --learning-rate 0.0003 \
    --weight-decay 0.0001 \
    --grad-clip-norm 2.0 \
    --label-smoothing 0.01 \
    --n-camera-bins 5 \
    --num-workers 24 \
    --warmup-steps 12500 \
    --backbone resnet18 \
    --button-weight 1.0 \
    --camera-weight 1.2 \
    --categorical-weight 1.0 \
    --class-weight-temperature 0.4 \
    --seed 0 \
    --checkpoint-interval 2 \
    --output checkpoints/bc_diamond_action_inven1/bc_diamond.ckpt \
    --sampler-chunk-size 256 \
    --prefetch-factor 6 \
    --cifar-stem False

    --checkpoint /workspace/foundation-dagger/foundation-dagger/checkpoints/bc_diamond_7/bc_diamond_epoch018.ckpt \

Eval
sudo add-apt-repository ppa:openjdk-r/ppa
sudo apt-get update
sudo apt-get install openjdk-8-jdk

if ! command -v fluxbox >/dev/null 2>&1; then
  sudo apt-get update && sudo apt-get install -y \
    xvfb x11vnc fluxbox mesa-utils \
    libgl1-mesa-dri libglu1-mesa libgl1 \
    libxi6 libxtst6 libxrandr2 libxrender1 libxinerama1 libxcursor1
fi

pkill -f 'Xvfb :99' || true
Xvfb :99 -screen 0 1920x1080x24 -ac >/tmp/xvfb.log 2>&1 &
export DISPLAY=:99

( fluxbox >/tmp/fluxbox.log 2>&1 & )

pkill -f x11vnc || true
x11vnc -display :99 -rfbport 5900 -listen 0.0.0.0 \
  -nopw -forever -shared -xkb >/tmp/x11vnc.log 2>&1 &

python scripts/minerl_evaluation_diamond.py \
    --checkpoint /workspace/foundation-dagger/foundation-dagger/checkpoints/bc_diamond_action_inven1/bc_diamond_epoch060.ckpt \
    --env-id MineRLObtainDiamondShovel-v0 \
    --context-frames 1 \
    --episodes 2 \
    --seed 4 \
    --output-dir /workspace/foundation-dagger/foundation-dagger/outputs/diamond10 \
    --max-steps 12000 \
    --warmup-steps 5 \
    --stochastic \
    --temperature 0.5 \
    --camera-temperature 1.0

pkill -f 'Xvfb :99' || true
rm -f /tmp/.X99-lock